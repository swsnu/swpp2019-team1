env:
  global:
    # include $HOME/.local/bin for `aws`
    - PATH=$HOME/.local/bin:$PATH

before_install:
  # set up awscli packages
  - pip install --user awscli
  # - mkdir -p ~/$TRAVIS_BUILD_NUMBER
  - aws s3 sync s3://travis-build-stages-shared-storage-test/$TRAVIS_BUILD_NUMBER /home/travis/build/swsnu/swpp2019-team1

jobs:
  include:
    - language: node_js
      node_js:
        - "10"
      dist: trusty
      install:
        - cd front
        - yarn install
      script:
        - "./node_modules/.bin/eslint src"
        - yarn testf_
      after_script:
        - yarn coveralls

    - language: python
      python: 3.7.4
      dist: xenial
      install:
        - cd back
        - pip install -r requirements.txt
      script:
        - coverage run --branch --source="." -m pytest
        - coverage report --fail-under=80 -m
        - coverage xml
        - pylint ./*/
      after_script:
        - coveralls
    - stage: Sonarcloud code anaysis
      script:
        - sonar-scanner

after_success:
  - aws s3 sync /home/travis/build/swsnu/swpp2019-team1 s3://travis-build-stages-shared-storage-test/$TRAVIS_BUILD_NUMBER
